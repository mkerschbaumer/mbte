<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute metrics for a <code><a href='tbl_mbte.html'>tbl_mbte</a></code> with fitted signals — mbte_compute_metrics • mbte</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Compute metrics for a <code><a href='tbl_mbte.html'>tbl_mbte</a></code> with fitted signals — mbte_compute_metrics" />

<meta property="og:description" content="The presence of the `signal`- and `fits`-columns is required. An (error)-
metric is computed based on the fitted signal-values and the original signal-
values. This gets done in order to allow a comparison of different
fitting-methods or to detect trends (e.g. an error metric gets used. A low
error indicates, that the a model has been able to generalize the underlying
trend)." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mbte</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/general-workflow.html">General Workflow</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mkerschbaumer/mbte">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute metrics for a <code><a href='tbl_mbte.html'>tbl_mbte</a></code> with fitted signals</h1>
    <small class="dont-index">Source: <a href='https://github.com/mkerschbaumer/mbte/blob/master/R/compute_metrics.R'><code>R/compute_metrics.R</code></a></small>
    <div class="hidden name"><code>mbte_compute_metrics.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The presence of the `signal`- and `fits`-columns is required. An (error)-
metric is computed based on the fitted signal-values and the original signal-
values. This gets done in order to allow a comparison of different
fitting-methods or to detect trends (e.g. an error metric gets used. A low
error indicates, that the a model has been able to generalize the underlying
trend).</p>
    
    </div>

    <pre class="usage"><span class='fu'>mbte_compute_metrics</span>(<span class='no'>x</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A <code><a href='tbl_mbte.html'>tbl_mbte</a></code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>The ellipsis must only contain named elements. The elements are
used as <code><a href='https://rlang.r-lib.org/reference/quotation.html'>quosures</a></code> via
<code><a href='https://rlang.r-lib.org/reference/eval_tidy.html'>tidy evaluation</a></code>. The quosures should perform
the metric computation. Caution: `.pred` and `.obs` are masked (See details
for more information). <code><a href='https://rlang.r-lib.org/reference/tidy-dots.html'>tidy-dots</a></code>-semantics are
supported.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A tibble with the following columns:</p><dl class='dl-horizontal'>
  <dt>desc</dt><dd><p>In this case, `desc` is a placeholder for all the columns
    in <code>x</code>, which are not columns for `signal` or `fits` (can be seen as
    descriptive columns).</p></dd>
  <dt>fit</dt><dd><p>A character column with the name of the fits. Its elements will
    be the names of the fitting quosures used (in most cases the names of
    the fitting quosures in the call to <code><a href='mbte_fit.html'>mbte_fit</a></code>).</p></dd>
  <dt>metric</dt><dd><p>The name of the metric-quosure, which computed the result.</p></dd>
  <dt>result</dt><dd><p>The actual result from the metric-computation (numeric or
    integer, depending on what type the metric quosures returned).</p></dd>
</dl>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The metric quosures can use the following masked objects (see examples):</p><dl class='dl-horizontal'>
  <dt>.pred</dt><dd><p>The predicted signal-values</p></dd>
  <dt>.obs</dt><dd><p>The observed/measured (original) signal-values</p></dd>
</dl>
    <p>Both masked objects (<code>.pred</code> and <code>.obs</code>) are numeric vectors.</p>
<p>A metric quosure must evalutate to a scalar numeric (double or integer-vector
of length 1). Otherwise or if an error is encountered, <code>NA_real_</code> will
be the result of the metric computation.</p>
    
    <h2 class="hasAnchor" id="event-log"><a class="anchor" href="#event-log"></a>event-log</h2>

    
    <p>A tibble containing event-information with the following columns:</p><dl class='dl-horizontal'>
  <dt>error</dt><dd><p>The error, which occurred during processing. Errors occurring
    during the evaluation of a metric-quosure are wrapped.</p></dd>
  <dt>row_nr</dt><dd><p>The row-number of the original table (<code>x</code>), at which the
    error occurred.</p></dd>
  <dt>fit_name</dt><dd><p>The name of the fit.</p></dd>
  <dt>metric_name</dt><dd><p>The name of the current metric (a name in <code>...</code>).
    NOTE: "current" referes to the moment the error/event occurred).</p></dd>
  <dt>metric_quo</dt><dd><p>The current metric-quosure (element of <code>...</code>).</p></dd>
  <dt>pred</dt><dd><p>The current predicted signal-values (expected to be be
    numeric).</p></dd>
  <dt>obs</dt><dd><p>The observed signal-values (of the original signal).</p></dd>
</dl>
    <p>NOTE: currently only errors are logged.</p>
    
    <h2 class="hasAnchor" id="event-logging"><a class="anchor" href="#event-logging"></a>event-logging</h2>

    
    <p>This function logs unusual events. A warning gets raised at the end of an
execution, if events have been logged. The event-log can be retrieved
by passing the returned object to <code><a href='event-logging.html'>mbte_event_log</a></code>. In this
case, a tibble containing the logged events will be returned to the user.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='filtered_signals.html'>filtered_signals</a></code> (dataset used in examples)</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/data'>data</a></span>(<span class='no'>filtered_signals</span>)
<span class='no'>filtered_signals</span></div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 37 x 3</span><span>
#&gt;    mv    signal_nr signal           
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;list&gt;</span><span>           
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> mv1           1 </span><span style='color: #949494;'>&lt;tibble [22 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> mv3           2 </span><span style='color: #949494;'>&lt;tibble [22 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> mv5           1 </span><span style='color: #949494;'>&lt;tibble [30 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> mv6           1 </span><span style='color: #949494;'>&lt;tibble [21 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> mv6           3 </span><span style='color: #949494;'>&lt;tibble [30 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> mv7           1 </span><span style='color: #949494;'>&lt;tibble [56 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> mv8           1 </span><span style='color: #949494;'>&lt;tibble [29 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> mv8           2 </span><span style='color: #949494;'>&lt;tibble [26 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> mv9           1 </span><span style='color: #949494;'>&lt;tibble [63 × 2]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> mv10          1 </span><span style='color: #949494;'>&lt;tibble [25 × 2]&gt;</span><span>
#&gt; </span><span style='color: #949494;'># … with 27 more rows</span><span></div><div class='input'>
<span class='co'># fit linear model to each signal (`t` denotes the time column)</span>
<span class='no'>fits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='mbte_fit.html'>mbte_fit</a></span>(<span class='no'>filtered_signals</span>, <span class='kw'>lm</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>value</span> ~ <span class='no'>t</span>, <span class='no'>.signal</span>))

<span class='co'># define error metric (in this case normalized root mean squared error)</span>
<span class='no'>nrmse</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>pred</span>, <span class='no'>obs</span>) {
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/MathFun'>sqrt</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>((<span class='no'>pred</span> - <span class='no'>obs</span>)^<span class='fl'>2</span>)) / (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Extremes'>max</a></span>(<span class='no'>obs</span>) - <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Extremes'>min</a></span>(<span class='no'>obs</span>))
}

<span class='co'># compute metrics</span>
<span class='co'># NOTE: `.pred` and `.obs` not present in scope, but provided via masking</span>
<span class='no'>metrics</span> <span class='kw'>&lt;-</span> <span class='fu'>mbte_compute_metrics</span>(<span class='no'>fits</span>, <span class='kw'>nrmse</span> <span class='kw'>=</span> <span class='fu'>nrmse</span>(<span class='no'>.pred</span>, <span class='no'>.obs</span>))
<span class='no'>metrics</span></div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 37 x 5</span><span>
#&gt;    mv    signal_nr fit   metric result
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> mv1           1 lm    nrmse  0.166 
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> mv3           2 lm    nrmse  0.146 
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> mv5           1 lm    nrmse  0.237 
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> mv6           1 lm    nrmse  0.246 
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> mv6           3 lm    nrmse  0.097</span><span style='text-decoration: underline;'>9</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> mv7           1 lm    nrmse  0.254 
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> mv8           1 lm    nrmse  0.222 
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> mv8           2 lm    nrmse  0.221 
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> mv9           1 lm    nrmse  0.243 
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> mv10          1 lm    nrmse  0.156 
#&gt; </span><span style='color: #949494;'># … with 27 more rows</span><span></div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#event-log">event-log</a></li>

      <li><a href="#event-logging">event-logging</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Martin Kerschbaumer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

